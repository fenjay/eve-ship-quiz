@model Eve_Ship_ID.Models.ShipQuiz

@{
    ViewBag.Title = "EVE Online Ship Identification Quiz";
}
<script>


    function NextQuestion() {
        /* 
        elimiate and use HandleAnswer() or NextQuestion()
        was only needed when same button accepted answer or hit next question
        idea: on last question, submit = results page

        if initial, then run HandleAnswer  
        if done, submit NextQuestionForm
       
//        */
//        if ($("#completionstatus").text() == "initial") {
//            //$("#completiondiv").css("background-color", "blue");
//            HandleAnswer();
//        }

        score = $("#endValue").val();
        var scoreArray = score.split(";");
        nbrAnswered = (scoreArray.length-1) / 2;  //trailing ; makes a blank entry so subtract one
        //alert(nbrAnswered);

        if (($("#completionstatus").text() == "nextquestion")) {
            if (nbrAnswered < 20) {
                nextQuestionForm.submit();
            }
            else {
                $("#innerquiz").css("display", "none");
                $("#quizresults").css("display", "inline-block");
                $("#currentscore").css("display", "none");
                $("#startoverlink").css("display", "none");
            }
        }
       
    }


    function HandleAnswer() {
        $("#mainformSubmit").css("display", "none");  //no such control?

        question = "@Model.ShipName";

        answer = $("input[type='radio'][name='typeOption']:checked").val();

        $.get("/EveShipIDQuiz/GetCorrectAnswer", { id: question })
        .done(function (correctanswer) {
            $("#shipdescp").append(correctanswer);
            shipDesc = $.get("/EveShipIDQuiz/GetShipDescription", { id: question })
            .done(function (descr) {
                $("#shipdescp").append("<br/><br/>");
                $("#shipdescp").append(descr);
                $("#shipdescription").css("display", "inherit");
            }); //subquery for ShipDesc. Must append in order or title can end up on bottom due to response time

            shipId = $.get("/EveShipIDQuiz/GetShipId", { id: question })
            .done(function (shipid) {
                $("#shipimg").css("width", "256px");
                $("#shipimg").css("height", "256px");
                $("#shipimg").attr("src", "images/Renders/" + shipid + ".png");

                if (answer == correctanswer) {
                    HandleRightAnswer(shipid);
                }
                else {
                    HandleWrongAnswer(shipid, correctanswer);
                }

            });  //subquery for shipID. use it both to set correct/incorrect status and to populate the image.

            $("#completionstatus").text('nextquestion'); // move me out
        }); //end correct answer query

        

    }

    function HandleRightAnswer(shipId) {
        score = $("#startValue").val();
        $("#completiondiv").css("display", "inline-block");
        $("#completiondiv").css("background-color", "green");
        $("#shipdescription").css("background-color", "#002200");
        $("#endValue").val(score + shipId + ";1;");
    }

    function HandleWrongAnswer(shipId, rightAnswer) {
        score = $("#startValue").val();
        $("#completiondiv").css("display", "inline-block");
        $("#completiondiv").css("background-color", "red");
        $("#shipdescription").css("background-color", "#330000");

        var j = 0;
        $('input:radio').each(function () {
            j++;
            if ($(this).val() == rightAnswer) {
                $("#answer" + j).css("background-color", "green");
            }
        });
        $("#endValue").val(score + shipId + ";0;");
    }

    function CheckAnswer(i,bar)
    {
        var elements = document.getElementsByName('typeOption');
        elements[i].checked = true;
        HandleAnswer();
    }

    function TurnBlue(i) {
    if ($("#completionstatus").text() != "nextquestion") {
        $(i).css("background-color", "blue");
        $(i).css("color", "white");
        }
    }

    function TurnLightBlue(i) {
        if ($("#completionstatus").text() != "nextquestion") {
            $(i).css("background-color", "#3399FF");
            $(i).css("color", "black");
        }
    }

</script>

<a name="quizloc"></a>

@if (@Model.score.Length == 0)
{
     <div style="width:40%;float:left">
   <p style="vertical-align:bottom">New Quiz</p>
   </div>   
}
else
{
    <div id="currentscore" style="width:40%;float:left">
   <p class="scoreheader"><b>Current Score:</b>&nbsp;@Model.ParseScore()</p>
</div>
}
    
<div id="quizresults" class="quizresults">

  <h2>Final Score:</h2>@Model.ParseScore()
   <br /><a style="vertical-align:top" href="/EveShipIDQuiz?resetquiz=1">Start Over</a>

</div>

<div id="startoverlink" style="width:40%;float:right">
<a style="vertical-align:bottom" href="/EveShipIDQuiz?resetquiz=1">Start Over</a>
</div>

<div id="innerquiz" class="innerquiz">
<div id="divider" class="divider">

<div class="quizheader">@Model.ShipName</div>
<br />

<form id="quizform" style="display:none">
@foreach (var name in @Model.ShipTypeOptions)
{
    <input type="radio" name="typeOption" value="@name">@name <br/>
}
</input>

</form>

<div id="answer1" class="answerbar" onclick="CheckAnswer(0,this)" onmouseover="TurnBlue(this);" onmouseout="TurnLightBlue(this);" > @Model.ShipTypeOptions[0] </div>
<div id="answer2" class="answerbar" onclick="CheckAnswer(1,this)" onmouseover="TurnBlue(this);" onmouseout="TurnLightBlue(this);"> @Model.ShipTypeOptions[1] </div>
<div id="answer3" class="answerbar" onclick="CheckAnswer(2,this)" onmouseover="TurnBlue(this);" onmouseout="TurnLightBlue(this);"> @Model.ShipTypeOptions[2] </div>
<div id="answer4" class="answerbar" onclick="CheckAnswer(3,this)" onmouseover="TurnBlue(this);" onmouseout="TurnLightBlue(this);"> @Model.ShipTypeOptions[3] </div>

<br />


<div id="completiondiv" class="completion" onclick="NextQuestion();">Next Ship</div>

</div><!--divider-->

<div id="shipdescription" class="shipdescription">
<label id="shipdescp"/></label>
<br />
<img id="shipimg" />
</div>

</div>

</div>


<label id="completionstatus" style="visibility:hidden">initial</label>

<form action="/EveShipIDQuiz" method="post" id="nextQuestionForm" style="visibility:hidden">
<input id="startValue" name="startValue" type="hidden" value="@Model.score"/>
<input id="endValue" name="endValue" type="hidden" />
<input id="nextpagesubmit" type="submit" value="Next Page"/>
</form>


