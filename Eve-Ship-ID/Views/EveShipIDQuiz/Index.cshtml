@model Eve_Ship_ID.Models.ShipQuiz

@{
    ViewBag.Title = "EVE Online Ship Identification Quiz";
}
<script>


    function HandleCompletion() {
        /* 
        elimiated and use HandleAnswer() or NextQuestion()
        was only needed when same button accepted answer or hit next question
        idea: on last question, submit = results page

        if initial, then run HandleAnswer  
        if done, submit NextQuestionForm
       
        */
        if ($("#completionstatus").text() == "initial") {
            //$("#completiondiv").css("background-color", "blue");
            HandleAnswer();
        }

        score = $("#endValue").val();

        if (($("#completionstatus").text() == "nextquestion")) {
            if (score.length < 20) {
                nextQuestionForm.submit();
            }
            else {
                $("#innerquiz").css("display", "none");
                $("#quizresults").css("display", "inline-block");
                $("#currentscore").css("display", "none");
                $("#startoverlink").css("display", "none");
            }
        }
       
    }


    function HandleAnswer() {
        $("#mainformSubmit").css("display","none");
        question = "@Model.ShipName";
        answer = $("input[type='radio'][name='typeOption']:checked").val();

        correctanswer = $.get("/EveShipIDQuiz/GetCorrectAnswer", { id: question })
        .done(function (data) {
            $("#shipdescp").append(data);
            if (data == answer) {
                HandleRightAnswer();
            }
            else {
                HandleWrongAnswer(data);
            }
            $("#completionstatus").text('nextquestion'); // move me out
        });

        shipId = $.get("/EveShipIDQuiz/GetShipId", { id: question })
        .done(function (data) {
            $("#shipimg").css("width", "256px");
            $("#shipimg").css("height", "256px");
            $("#shipimg").attr("src", "images/Renders/" + data + ".png");
        });

        shipDesc = $.get("/EveShipIDQuiz/GetShipDescription", { id: question })
        .done(function (data) {
            $("#shipdescp").append("<br/><br/>");
            $("#shipdescp").append(data);
            $("#shipdescription").css("display", "inherit");
        });



    }

    function HandleRightAnswer() {
        score = $("#startValue").val();
        $("#completiondiv").css("display", "inline-block");
        $("#completiondiv").css("background-color", "green");
        $("#endValue").val(score + "1");
    }

    function HandleWrongAnswer(rightAnswer) {
        score = $("#startValue").val();
        $("#completiondiv").css("display", "inline-block");
        $("#completiondiv").css("background-color", "red");
        $("#shipdescription").css("background-color", "#330000");

        var j = 0;
        $('input:radio').each(function () {
            j++;
            if ($(this).val() == rightAnswer) {
                $("#answer" + j).css("background-color", "green");
            }
        });
        $("#endValue").val(score + "0");
    }

    function CheckAnswer(i,bar)
    {
        var elements = document.getElementsByName('typeOption');
        elements[i].checked = true;
        HandleCompletion();
    }

    function TurnBlue(i) {
    if ($("#completionstatus").text() != "nextquestion") {
        $(i).css("background-color", "blue");
        $(i).css("color", "white");
        }
    }

    function TurnLightBlue(i) {
        if ($("#completionstatus").text() != "nextquestion") {
            $(i).css("background-color", "#3399FF");
            $(i).css("color", "black");
        }
    }

</script>

<a name="quizloc"></a>

@if (@Model.score.Length == 0)
{
     <div style="width:40%;float:left">
   <p style="vertical-align:bottom">New Quiz</p>
   </div>   
}

    <div id="currentscore" style="width:40%;float:left">
   <p class="scoreheader"><b>Current Score:</b>&nbsp;@Model.ParseScore()</p>
</div>

    
<div id="quizresults" class="quizresults">

  <h2>Final Score:</h2>@Model.ParseScore()
   <br /><a style="vertical-align:top" href="/EveShipIDQuiz?resetquiz=1">Start Over</a>

</div>

<div id="startoverlink" style="width:40%;float:right">
<a style="vertical-align:bottom" href="/EveShipIDQuiz?resetquiz=1">Start Over</a>
</div>

<div id="innerquiz" class="innerquiz">
<div id="divider" class="divider">

<div class="quizheader">@Model.ShipName</div>
<br />

<form id="quizform" style="display:none">
@foreach (var name in @Model.ShipTypeOptions)
{
    <input type="radio" name="typeOption" value="@name">@name <br/>
}
</input>

</form>

<div id="answer1" class="answerbar" onclick="CheckAnswer(0,this)" onmouseover="TurnBlue(this);" onmouseout="TurnLightBlue(this);" > @Model.ShipTypeOptions[0] </div>
<div id="answer2" class="answerbar" onclick="CheckAnswer(1,this)" onmouseover="TurnBlue(this);" onmouseout="TurnLightBlue(this);"> @Model.ShipTypeOptions[1] </div>
<div id="answer3" class="answerbar" onclick="CheckAnswer(2,this)" onmouseover="TurnBlue(this);" onmouseout="TurnLightBlue(this);"> @Model.ShipTypeOptions[2] </div>
<div id="answer4" class="answerbar" onclick="CheckAnswer(3,this)" onmouseover="TurnBlue(this);" onmouseout="TurnLightBlue(this);"> @Model.ShipTypeOptions[3] </div>

<br />


<div id="completiondiv" class="completion" onclick="HandleCompletion();">Next Ship</div>

</div><!--divider-->

<div id="shipdescription" class="shipdescription">
<label id="shipdescp"/></label>
<br />
<img id="shipimg" />
</div>

</div>

</div>


<label id="completionstatus" style="visibility:hidden">initial</label>

<form action="/EveShipIDQuiz" method="post" id="nextQuestionForm" style="visibility:hidden">
<input id="startValue" name="startValue" type="hidden" value="@Model.score"/>
<input id="endValue" name="endValue" type="hidden" />
<input id="nextpagesubmit" type="submit" value="Next Page"/>
</form>


